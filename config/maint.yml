name: "comaint"

attributes:
  - name: "backend_project_dir"
    value: "comaint-backend"
  - name: "backend_project_version"
    value: "0.0.1"
  - name: "backend_project_description"
    value: "API server of Commaint project"
  - name : "database_name"
    value: "db_comaint"
  - name: "database_schema_version"
    value: "1"
  - name: "api_version"
    value: "v1"

  - name: "frontend-project"
    value: "comaint-frontend"

objects:
  - name: "user"
    attributes:
      - name: "pascal_name"
        value: "User"
      - name: "camel_name"
        value: "user"
      - name: "kebab_name"
        value: "user"
      - name: "snake_name"
        value: "user"
      - name: "table_name"
        value: "users"
    properties:
      - name: "id"
        type: "id"
      - name: "email"
        type: "string"
        maximum: 320
      - name: "phone"
        type: "string"
        mandatory: false
      - name: "address"
        type: "text"
        mandatory: true
        default: ""


  - name: "product"
    attributes:
      - name: "pascal_name"
        value: "Product"
      - name: "camel_name"
        value: "product"
      - name: "kebab_name"
        value: "product"
      - name: "snake_name"
        value: "product"
      - name: "table_name"
        value: "products"
    properties:
      - name: "id"
        type: "id"
      - name: "name"
        type: "string"


  - name: "Company"
    attributes:
      - name: "pascal_name"
        value: "Company"
      - name: "camel_name"
        value: "company"
      - name: "kebab_name"
        value: "company"
      - name: "snake_name"
        value: "company"
      - name: "table_name"
        value: "companies"
    properties:
      - name: "id"
        type: "id"
      - name: "name"
        type: "string"
      - name: "address"
        type: "text"
        default: ""
      - name: "equipmentUnitCount"
        type: "integer"
        default: 0
      - name: "equipmentUnitSectionCount"
        type: "integer"
        default: 0
      - name: "equipmentFamilyCount"
        type: "integer"
        default: 0
      - name: "equipmentTypeCount"
        type: "integer"
        default: 0
      - name: "equipmentCount"
        type: "integer"
        default: 0
    indexes:
      - name: "name"
        unique: true
        keys:
          - property : "name"


  - name: "Unit"
    attributes:
      - name: "pascal_name"
        value: "Unit"
      - name: "camel_name"
        value: "unit"
      - name: "kebab_name"
        value: "unit"
      - name: "snake_name"
        value: "unit"
      - name: "table_name"
        value: "units"
    properties:
      - name: "id"
        type: "id"
      - name: "name"
        type: "string"
      - name: "description"
        type: "string"
      - name: "equipmentUnitSectionCount"
        type: "integer"
        default: 0
      - name: "equipmentCount"
        type: "integer"
        default: 0
    links:
      - name: "company"
        target: "Company"
    indexes:
      - name: "unit_name"
        unique: true
        keys:
          - link: "company"
          - property : "name"

  - name: "UnitSection"
    attributes:
      - name: "pascal_name"
        value: "UnitSection"
      - name: "camel_name"
        value: "unitSection"
      - name: "kebab_name"
        value: "unit-section"
      - name: "snake_name"
        value: "unit_section"
      - name: "table_name"
        value: "unit_sections"
    properties:
      - name: "id"
        type: "id"
      - name: "name"
        type: "string"
      - name: "description"
        type: "string"
      - name: "equipmentCount"
        type: "integer"
        default: 0
    links:
      - name: "unit"
        target: "Unit"
    indexes:
      - name: "unit_name"
        unique: true
        keys:
          - link : "unit"
          - property : "name"
 

  - name: "EquipmentFamily"
    attributes:
      - name: "pascal_name"
        value: "EquipmentFamily"
      - name: "camel_name"
        value: "equipmentFamily"
      - name: "kebab_name"
        value: "equipment-family"
      - name: "snake_name"
        value: "equipment_family"
      - name: "table_name"
        value: "equipment_families"
    properties:
      - name: "id"
        type: "id"
      - name: "name"
        type: "string"
        minimum: 2
        maximum: 30
      - name: "description"
        type: "string"
        mandatory: false
      - name: "equipmentTypeCount"
        type: "integer"
        default: 0
      - name: "equipmentCount"
        type: "integer"
        default: 0
    links:
      - name: "company"
        target: "Company"
    indexes:
      - name: "compagny_name"
        keys:
          - link: "company"
          - property: "name"


  - name: "EquipmentType"
    attributes:
      - name: "pascal_name"
        value: "EquipmentType"
      - name: "camel_name"
        value: "equipmentType"
      - name: "kebab_name"
        value: "equipment-type"
      - name: "snake_name"
        value: "equipment_type"
      - name: "table_name"
        value: "equipment_types"
    properties:
      - name: "id"
        type: "id"
      - name: "name"
        type: "string"
      - name: "description"
        type: "string"
        mandatory: false
      - name: "equipmentCount"
        type: "integer"
        default: 0
    links:
      - name : "family"
        target: "EquipmentFamily"
        mandatory: true
    indexes:
      - name: "family_name"
        unique: true
        keys:
          - link : "family"
          - property: "name"
 

  - name: "Equipment"
    attributes:
      - name: "pascal_name"
        value: "Equipment"
      - name: "camel_name"
        value: "equipment"
      - name: "kebab_name"
        value: "equipment"
      - name: "snake_name"
        value: "equipment"
      - name: "table_name"
        value: "equipment"
    properties:
      - name: "id"
        type: "id"
      - name: "name"
        type: "string"
      - name: "description"
        type: "string"
    links:
      - name: "type"
        target: "EquipmentType"
      - name: "section"
        target: "UnitSection"
    indexes:
      - name: "type_name"
        unique: true
        keys:
          - link : "type"
          - property: "name"
      - name: "section_name"
        unique: false
        keys:
          - link : "section"
          - property: "name"




files:
  - scope:  "project"
    input:  "config/init-db.sql"
    output: "output/init-db.sql"

  - scope:  "project"
    input:  "config/backend/package.json"
    output: "output/{{project.attributes.backend_project_dir}}/package.json"

  - scope:  "project"
    input:  "config/backend/config.json.sample"
    output: "output/{{project.attributes.backend_project_dir}}/config.json.sample"

  - scope:  "project"
    input:  "config/backend/server.js"
    output: "output/{{project.attributes.backend_project_dir}}/src/server.js"

  - scope:  "project"
    input:  "config/backend/model.js"
    output: "output/{{project.attributes.backend_project_dir}}/src/models/model.js"

  - scope:  "object"
    input:  "config/backend/object-model.js"
    output: "output/{{project.attributes.backend_project_dir}}/src/models/{{object.attributes.kebab_name}}-model.js"

  - scope:  "project"
    input:  "config/backend/view.js"
    output: "output/{{project.attributes.backend_project_dir}}/src/views/view.js"

  - scope:  "project"
    input:  "config/backend/controller.js"
    output: "output/{{project.attributes.backend_project_dir}}/src/routes/controller.js"

  - scope:  "object"
    input:  "config/backend/object-routes.js"
    output: "output/{{project.attributes.backend_project_dir}}/src/routes/{{object.attributes.kebab_name}}-routes.js"


