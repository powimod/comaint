{%- assign filename = object.name | kebabCase | append: "-api.js" -%}
{% render "../../templates/license_header_js.liquid",
		project     : project.attributes.backend_project_name,
  		description : project.attributes.backend_project_description,
		authors     : project.attributes.authors,
		copyright   : project.attributes.copyright,
		filename    : filename 
		%}
'use script';
const ModelSingleton = require('./model.js');
const model  = ModelSingleton.getInstance();

exports.get{{object.name | pascalCase}}List = async function (params) {
	const url = new URL(`${model.config.url}/{{object.name | camelCase}}/list`);
	if (params.resultsPerPage !== undefined)
		url.searchParams.append('resultsPerPage', params.resultsPerPage);
	try {
		const fetchParams = {
			method : 'GET',
			headers: {
				'Accept': 'application/json',
				'Content-Type': 'application/json',
				'x-access-token': params.accessToken
			}
		}
		let {{object.name | camelCase}}List = [];
		const result = await fetch(url, fetchParams);
		if (result.status !== 200)
			throw new Error('HTTP response status is not 200');
		const json = await result.json();
		//TODO controlJsonResponse(json);
		{{object.name | camelCase}}List = json.data.{{object.name | camelCase}}List;
		if ({{object.name | camelCase}}List === undefined)
			throw new Error('{{object.name | pascalCase}} list not found is HTTP response');
		return {ok: true, {{object.name | camelCase}}List: {{object.name | camelCase}}List};
	}
	catch (error) {
		return {
			ok: false, 
			error: (error.message !== undefined) ? error.message : error
		};
	}
}


exports.get{{object.name | pascalCase}}Details = async function (id{{object.name | pascalCase}}) {
	if (id{{object.name | pascalCase}} === undefined)
		throw new Error('Argument <id{{object.name | pascalCase}}> required');
	if (isNaN(id{{object.name | pascalCase}}))
		throw new Error('Argument <id{{object.name | pascalCase}}> is not a number');
	const url = new URL(`${model.config.url}/{{object.name | camelCase}}/${id{{object.name | pascalCase}}}`);
	try {
		let {{object.name | camelCase}} = null;
		const result = await fetch(url);
		if (result.status !== 200)
			throw new Error('HTTP response status is not 200');
		const json = await result.json();
		//TODO controlJsonResponse(json);
		{{object.name | camelCase}} = json.data.{{object.name | camelCase}};
		if ({{object.name | camelCase}} === undefined)
			throw new Error('{{object.name | pascalCase}} list not found is HTTP response');
		return {ok: true, {{object.name | camelCase}}: {{object.name | camelCase}}};
	}
	catch (error) {
		return {
			ok: false, 
			error: (error.message !== undefined) ? error.message : error
		};
	}
}

